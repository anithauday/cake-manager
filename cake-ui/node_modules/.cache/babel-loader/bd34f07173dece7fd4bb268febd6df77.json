{"ast":null,"code":"import axios from 'axios';\nimport { config } from '../../Constants';\nimport { parseJwt } from './Helpers';\nexport const cakeApi = {\n  authenticate,\n  numberOfUsers,\n  numberOfOrders,\n  getUsers,\n  getCakes,\n  deleteOrder,\n  createCake,\n  getUserMe\n};\n\nfunction authenticate(username, password) {\n  return instance.post('/auth/login', {\n    username,\n    password\n  }, {\n    headers: {\n      'Content-type': 'application/json',\n      \"Access-Control-Allow-Origin\": \"*\"\n    }\n  });\n}\n\nfunction numberOfUsers() {\n  return instance.get('/public/numberOfUsers');\n}\n\nfunction numberOfOrders() {\n  return instance.get('/public/numberOfOrders');\n}\n\nfunction getUsers(user, username) {\n  const url = username ? `/api/users/${username}` : '/api/users';\n  return instance.get(url, {\n    headers: {\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nfunction getCakes(user) {\n  const url = '/api/v1';\n  return instance.get(url, {\n    headers: {\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nfunction deleteOrder(user, orderId) {\n  return instance.delete(`/api/orders/${orderId}`, {\n    headers: {\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nfunction createCake(user, cake) {\n  return instance.post('/api/v1/cake', cake, {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nfunction getUserMe(user) {\n  return instance.get('/api/users/me', {\n    headers: {\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nconst instance = axios.create({\n  baseURL: config.url.API_BASE_URL\n});\ninstance.interceptors.request.use(function (config) {\n  // If token is expired, redirect user to login\n  if (config.headers.Authorization) {\n    const token = config.headers.Authorization.split(' ')[1];\n    const data = parseJwt(token);\n\n    if (Date.now() > data.exp * 1000) {\n      window.location.href = \"/login\";\n    }\n  }\n\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\n\nfunction bearerAuth(user) {\n  return `Bearer ${user.accessToken}`;\n}","map":{"version":3,"sources":["/Users/baran/Desktop/cake-manager/cake-ui/src/components/misc/CakeApi.js"],"names":["axios","config","parseJwt","cakeApi","authenticate","numberOfUsers","numberOfOrders","getUsers","getCakes","deleteOrder","createCake","getUserMe","username","password","instance","post","headers","get","user","url","bearerAuth","orderId","delete","cake","create","baseURL","API_BASE_URL","interceptors","request","use","Authorization","token","split","data","Date","now","exp","window","location","href","error","Promise","reject","accessToken"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { config } from '../../Constants'\nimport { parseJwt } from './Helpers'\n\nexport const cakeApi = {\n  authenticate,\n  numberOfUsers,\n  numberOfOrders,\n  getUsers,\n  getCakes,\n  deleteOrder,\n  createCake,\n  getUserMe\n}\n\nfunction authenticate(username, password) {\n  return instance.post('/auth/login', { username, password }, {\n    headers: { 'Content-type': 'application/json' , \"Access-Control-Allow-Origin\": \"*\"}\n  })\n}\n\nfunction numberOfUsers() {\n  return instance.get('/public/numberOfUsers')\n}\n\nfunction numberOfOrders() {\n  return instance.get('/public/numberOfOrders')\n}\n\nfunction getUsers(user, username) {\n  const url = username ? `/api/users/${username}` : '/api/users'\n  return instance.get(url, {\n    headers: { 'Authorization': bearerAuth(user) }\n  })\n}\n\nfunction getCakes(user) {\n  const url = '/api/v1'\n  return instance.get(url, {\n    headers: { 'Authorization': bearerAuth(user) }\n  })\n}\n\nfunction deleteOrder(user, orderId) {\n  return instance.delete(`/api/orders/${orderId}`, {\n    headers: { 'Authorization': bearerAuth(user) }\n  })\n}\n\nfunction createCake(user, cake) {\n  return instance.post('/api/v1/cake', cake, {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    }\n  })\n}\n\nfunction getUserMe(user) {\n  return instance.get('/api/users/me', {\n    headers: { 'Authorization': bearerAuth(user) }\n  })\n}\n\n\nconst instance = axios.create({\n  baseURL: config.url.API_BASE_URL\n})\n\ninstance.interceptors.request.use(function (config) {\n  // If token is expired, redirect user to login\n  if (config.headers.Authorization) {\n    const token = config.headers.Authorization.split(' ')[1]\n    const data = parseJwt(token)\n    if (Date.now() > data.exp * 1000) {\n      window.location.href = \"/login\"\n    }\n  }\n  return config\n}, function (error) {\n  return Promise.reject(error)\n})\n\n\n\nfunction bearerAuth(user) {\n  return `Bearer ${user.accessToken}`\n}"]},"metadata":{},"sourceType":"module"}