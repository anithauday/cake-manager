{"ast":null,"code":"import axios from 'axios';\nimport { config } from '../../Constants';\nimport { parseJwt } from './Helpers';\nexport const cakeApi = {\n  authenticate,\n  getUsers,\n  getCakes,\n  createCake,\n  download\n};\n\nfunction authenticate(username, password) {\n  return instance.post('/auth/login', {\n    username,\n    password\n  }, {\n    headers: {\n      'Content-type': 'application/json',\n      \"Access-Control-Allow-Origin\": \"*\"\n    }\n  });\n}\n\nfunction download(user) {\n  return instance.get('/api/v1/cakes', {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    },\n    responseType: 'blob' // important\n\n  });\n}\n\nfunction getUsers(user, username) {\n  const url = username ? `/api/users/${username}` : '/api/users';\n  return instance.get(url, {\n    headers: {\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nfunction getCakes(user) {\n  const url = '/api/v1';\n  return instance.get(url, {\n    headers: {\n      'Authorization': bearerAuth(user),\n      \"Access-Control-Allow-Origin\": \"*\"\n    }\n  });\n}\n\nfunction createCake(user, cake) {\n  return instance.post('/api/v1/cake', cake, {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    }\n  });\n}\n\nconst instance = axios.create({\n  baseURL: config.url.API_BASE_URL\n});\ninstance.interceptors.request.use(function (config) {\n  // If token is expired, redirect user to login\n  if (config.headers.Authorization) {\n    const token = config.headers.Authorization.split(' ')[1];\n    const data = parseJwt(token);\n\n    if (Date.now() > data.exp * 1000) {\n      window.location.href = \"/login\";\n    }\n  }\n\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\n\nfunction bearerAuth(user) {\n  return `Bearer ${user.accessToken}`;\n}","map":{"version":3,"sources":["/Users/baran/Desktop/cake-manager/cake-ui/src/components/misc/CakeApi.js"],"names":["axios","config","parseJwt","cakeApi","authenticate","getUsers","getCakes","createCake","download","username","password","instance","post","headers","user","get","bearerAuth","responseType","url","cake","create","baseURL","API_BASE_URL","interceptors","request","use","Authorization","token","split","data","Date","now","exp","window","location","href","error","Promise","reject","accessToken"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,SAASC,QAAT,QAAyB,WAAzB;AAEA,OAAO,MAAMC,OAAO,GAAG;AACrBC,EAAAA,YADqB;AAErBC,EAAAA,QAFqB;AAGrBC,EAAAA,QAHqB;AAIrBC,EAAAA,UAJqB;AAKrBC,EAAAA;AALqB,CAAhB;;AAQP,SAASJ,YAAT,CAAsBK,QAAtB,EAAgCC,QAAhC,EAA0C;AACxC,SAAOC,QAAQ,CAACC,IAAT,CAAc,aAAd,EAA6B;AAAEH,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,GAA7B,EAAqD;AAC1DG,IAAAA,OAAO,EAAE;AAAE,sBAAgB,kBAAlB;AAAuC,qCAA+B;AAAtE;AADiD,GAArD,CAAP;AAGD;;AAED,SAASL,QAAT,CAAkBM,IAAlB,EAAwB;AACtB,SAAOH,QAAQ,CAACI,GAAT,CAAa,eAAb,EAA8B;AACnCF,IAAAA,OAAO,EAAE;AACP,sBAAgB,kBADT;AAEP,uBAAiBG,UAAU,CAACF,IAAD;AAFpB,KAD0B;AAKjCG,IAAAA,YAAY,EAAE,MALmB,CAKX;;AALW,GAA9B,CAAP;AAOD;;AAED,SAASZ,QAAT,CAAkBS,IAAlB,EAAwBL,QAAxB,EAAkC;AAChC,QAAMS,GAAG,GAAGT,QAAQ,GAAI,cAAaA,QAAS,EAA1B,GAA8B,YAAlD;AACA,SAAOE,QAAQ,CAACI,GAAT,CAAaG,GAAb,EAAkB;AACvBL,IAAAA,OAAO,EAAE;AAAE,uBAAiBG,UAAU,CAACF,IAAD;AAA7B;AADc,GAAlB,CAAP;AAGD;;AAED,SAASR,QAAT,CAAkBQ,IAAlB,EAAwB;AACtB,QAAMI,GAAG,GAAG,SAAZ;AACA,SAAOP,QAAQ,CAACI,GAAT,CAAaG,GAAb,EAAkB;AACvBL,IAAAA,OAAO,EAAE;AAAE,uBAAiBG,UAAU,CAACF,IAAD,CAA7B;AAAsC,qCAA+B;AAArE;AADc,GAAlB,CAAP;AAGD;;AAED,SAASP,UAAT,CAAoBO,IAApB,EAA0BK,IAA1B,EAAgC;AAC9B,SAAOR,QAAQ,CAACC,IAAT,CAAc,cAAd,EAA8BO,IAA9B,EAAoC;AACzCN,IAAAA,OAAO,EAAE;AACP,sBAAgB,kBADT;AAEP,uBAAiBG,UAAU,CAACF,IAAD;AAFpB;AADgC,GAApC,CAAP;AAMD;;AAGD,MAAMH,QAAQ,GAAGX,KAAK,CAACoB,MAAN,CAAa;AAC5BC,EAAAA,OAAO,EAAEpB,MAAM,CAACiB,GAAP,CAAWI;AADQ,CAAb,CAAjB;AAIAX,QAAQ,CAACY,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CAAkC,UAAUxB,MAAV,EAAkB;AAClD;AACA,MAAIA,MAAM,CAACY,OAAP,CAAea,aAAnB,EAAkC;AAChC,UAAMC,KAAK,GAAG1B,MAAM,CAACY,OAAP,CAAea,aAAf,CAA6BE,KAA7B,CAAmC,GAAnC,EAAwC,CAAxC,CAAd;AACA,UAAMC,IAAI,GAAG3B,QAAQ,CAACyB,KAAD,CAArB;;AACA,QAAIG,IAAI,CAACC,GAAL,KAAaF,IAAI,CAACG,GAAL,GAAW,IAA5B,EAAkC;AAChCC,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,QAAvB;AACD;AACF;;AACD,SAAOlC,MAAP;AACD,CAVD,EAUG,UAAUmC,KAAV,EAAiB;AAClB,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAZD;;AAeA,SAASpB,UAAT,CAAoBF,IAApB,EAA0B;AACxB,SAAQ,UAASA,IAAI,CAACyB,WAAY,EAAlC;AACD","sourcesContent":["import axios from 'axios'\nimport { config } from '../../Constants'\nimport { parseJwt } from './Helpers'\n\nexport const cakeApi = {\n  authenticate,\n  getUsers,\n  getCakes,\n  createCake,\n  download\n}\n\nfunction authenticate(username, password) {\n  return instance.post('/auth/login', { username, password }, {\n    headers: { 'Content-type': 'application/json' , \"Access-Control-Allow-Origin\": \"*\"}\n  })\n}\n\nfunction download(user) {\n  return instance.get('/api/v1/cakes', {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    }\n    , responseType: 'blob', // important\n  })\n}\n\nfunction getUsers(user, username) {\n  const url = username ? `/api/users/${username}` : '/api/users'\n  return instance.get(url, {\n    headers: { 'Authorization': bearerAuth(user) }\n  })\n}\n\nfunction getCakes(user) {\n  const url = '/api/v1'\n  return instance.get(url, {\n    headers: { 'Authorization': bearerAuth(user) , \"Access-Control-Allow-Origin\": \"*\" }\n  })\n}\n\nfunction createCake(user, cake) {\n  return instance.post('/api/v1/cake', cake, {\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': bearerAuth(user)\n    }\n  })\n}\n\n\nconst instance = axios.create({\n  baseURL: config.url.API_BASE_URL\n})\n\ninstance.interceptors.request.use(function (config) {\n  // If token is expired, redirect user to login\n  if (config.headers.Authorization) {\n    const token = config.headers.Authorization.split(' ')[1]\n    const data = parseJwt(token)\n    if (Date.now() > data.exp * 1000) {\n      window.location.href = \"/login\"\n    }\n  }\n  return config\n}, function (error) {\n  return Promise.reject(error)\n})\n\n\nfunction bearerAuth(user) {\n  return `Bearer ${user.accessToken}`\n}"]},"metadata":{},"sourceType":"module"}